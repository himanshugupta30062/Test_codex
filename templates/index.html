<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat Demo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
<div class="container">
    <div class="sidebar">
        <h3>History</h3>
        <ul id="history"></ul>
    </div>
    <div class="chat">
        <h1><span class="logo">ðŸ¤–</span> Chat Demo</h1>
        <div id="chat"></div>
        <textarea id="question" placeholder="Type your question"></textarea>
        <div class="buttons">
            <button id="askBtn">Ask</button>
            <button id="clearBtn">Clear</button>
        </div>
    </div>
</div>
<script>
const historyList = document.getElementById('history');
const chatDiv = document.getElementById('chat');
const textarea = document.getElementById('question');

function autoResize() {
    textarea.style.height = 'auto';
    textarea.style.height = textarea.scrollHeight + 'px';
}
textarea.addEventListener('input', autoResize);

async function sendQuestion() {
    const question = textarea.value.trim();
    if (!question) return;
    appendMessage('user', question);
    textarea.value = '';
    autoResize();
    const response = await fetch('/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question })
    });
    const data = await response.json();
    appendMessage('assistant', data.answer);
    addToHistory(question, data.answer);
}

function appendMessage(role, text) {
    const div = document.createElement('div');
    div.className = 'message ' + role;
    div.textContent = (role === 'user' ? 'You: ' : 'Assistant: ') + text;
    chatDiv.appendChild(div);
    chatDiv.scrollTop = chatDiv.scrollHeight;
}

function addToHistory(q, a) {
    const li = document.createElement('li');
    li.textContent = q;
    li.onclick = () => alert(a);
    historyList.appendChild(li);
}

function clearChat() {
    chatDiv.innerHTML = '';
    historyList.innerHTML = '';
}

document.getElementById('askBtn').addEventListener('click', sendQuestion);
document.getElementById('clearBtn').addEventListener('click', clearChat);
</script>
</body>
</html>
